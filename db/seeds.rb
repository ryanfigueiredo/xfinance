initial_payers = [
  {
    "name": "Ryan"
  },
  {
    "name": "Luana"
  },
  {
    "name": "IA"
  }
]

initial_groups = [
  {
    "title": "Cartao de Credito Nubank Ryan",
    "payment_day": "10",
    "close_day": "26",
    "kind": "expense",
  },
  {
    "title": "Cartao de Credito Pic Pay",
    "payment_day": "10",
    "close_day": "25",
    "kind": "expense",
  },
  {
    "title": "Cartao de Credito Nubank Mamae",
    "payment_day": "10",
    "close_day": "27",
    "kind": "expense",
  },
  {
    "title": "Mensalidade Luana",
    "payment_day": "10",
    "close_day": "15",
    "kind": "revenue",
  },
  {
    "title": "Despesas",
    "payment_day": "10",
    "close_day": "15",
    "kind": "expense",
  },
  {
    "title": "Investimentos",
    "payment_day": "10",
    "close_day": "15",
    "kind": "expense",
  },
  {
    "title": "Receitas",
    "payment_day": "30",
    "close_day": "15",
    "kind": "revenue",
  }
]

# finance transactions January of 2024

finance_transactions_nubank_mamae = [ # 2
  {
    "title": "Madeira Cama",
    "purchase_date": "26-12-2023",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": "04/10",
    "real_amount": 210.53
  },
  {
    "title": "Notebook Dell",
    "purchase_date": "26-12-2023",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": "07/12",
    "real_amount": 708.44
  },
  {
    "title": "Normatel",
    "purchase_date": "29-12-2023",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 86
  },
  {
    "title": "Normatel",
    "purchase_date": "30-12-2023",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 46.51
  },
  {
    "title": "Duto cabelos",
    "purchase_date": "30-12-2023",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 35
  },
  {
    "title": "first class",
    "purchase_date": "05-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 149.97
  },
  {
    "title": "first class",
    "purchase_date": "05-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 259.97
  },
  {
    "title": "Gs Riomar Carrinhos",
    "purchase_date": "05-01-2024",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 65
  },
  {
    "title": "Ri happy",
    "purchase_date": "05-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 199.99
  },
  {
    "title": "Sam michel",
    "purchase_date": "06-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 249.98
  },
  {
    "title": "Leitura Riomar",
    "purchase_date": "07-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 65
  },
  {
    "title": "Blitz Intervencoes",
    "purchase_date": "07-01-2024",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 43
  },
  {
    "title": "Sodine",
    "purchase_date": "07-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 120.64
  },
  {
    "title": "ArteForm Comercio",
    "purchase_date": "07-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 129.9
  },
  {
    "title": "Filial Fortaleza",
    "purchase_date": "07-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 39.9
  },
  {
    "title": "A Libaneza",
    "purchase_date": "07-01-2024",
    "group": ['Mensalidade Luana', 'Cartao de Credito Nubank Mamae'],
    "installments": '',
    "payers": "Luana,Ryan",
    "real_amount": 252.69
  },
  {
    "title": "Pag nildaMariaDaSilv",
    "purchase_date": "09-01-2024",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 20
  },
  {
    "title": "Mini Cars",
    "purchase_date": "09-01-2024",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 20
  },
  {
    "title": "Cd Max",
    "purchase_date": "11-01-2024",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 154.4
  },
  {
    "title": "Estacionamento Iguate",
    "purchase_date": "14-01-2024",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 10
  },
  {
    "title": "Pag SodineStore",
    "purchase_date": "11-01-2024",
    "group": 'Cartao de Credito Nubank Mamae',
    "installments": '',
    "real_amount": 458.93
  }
]

finance_transactions_nubank_ryan = [
  {
   "title": "Herman Miller",
   "purchase_date": "27-12-2023",
   "group": 'Cartao de Credito Nubank Ryan',
   "installments": "2/12",
   "real_amount": 954.68
  },
  {
   "title": "Amazon",
   "purchase_date": "29-12-2023",
   "group": 'Cartao de Credito Nubank Ryan',
   "installments": '',
   "real_amount": 47.29
  },
  {
   "title": "SmartFit",
   "purchase_date": "11-02-2024",
   "group": 'Cartao de Credito Nubank Ryan',
   "installments": '',
   "real_amount": 109.9
  },
  {
   "title": "Vivo Controle",
   "purchase_date": "15-01-2024",
   "group": 'Cartao de Credito Nubank Ryan',
   "installments": '',
   "real_amount": 54.99
  },
  {
   "title": "Pag Outgo",
   "purchase_date": "17-01-2024",
   "group": 'Cartao de Credito Nubank Ryan',
   "installments": '',
   "real_amount": 35
  }
]

finance_transactions_pic_pay = [
  {
   "title": "Amazon Subwoofer",
   "purchase_date": "28-05-2023",
   "group": 'Cartao de Credito Pic Pay',
   "installments": "6/10",
   "real_amount": 265.10
  },
]

finance_transactions_despesas = [
  {
   "title": "IPVA",
   "purchase_date": "02-01-2024",
   "installments": '',
   "group": 'Despesas',
   "real_amount": 1982.09
  },
  {
   "title": "Colegio Maria Julia",
   "purchase_date": "02-01-2024",
   "installments": '',
   "group": ['Mensalidade Luana', 'Despesas'],
   "payers": "Luana,Ryan",
   "real_amount": 700
  },
  {
   "title": "Material Escolar Maria J",
   "purchase_date": "03-01-2024",
   "installments": '',
   "group": ['Mensalidade Luana', 'Despesas'],
   "payers": "Luana,Ryan",
   "real_amount": 590
  },
  {
   "title": "Wilson Dantas Milho",
   "purchase_date": "05-01-2024",
   "installments": '',
   "group": 'Despesas',
   "real_amount": 5
  },
  {
   "title": "Wilson Dantas Milho",
   "purchase_date": "05-01-2024",
   "installments": '',
   "group": 'Despesas',
   "real_amount": 5
  },
  {
   "title": "Raxa BNB",
   "purchase_date": "09-01-2024",
   "installments": '',
   "group": 'Despesas',
   "real_amount": 20
  },
  {
   "title": "Grafica Point S Com",
   "purchase_date": "11-01-2024",
   "installments": '',
   "group": 'Despesas',
   "real_amount": 26
  },
  {
   "title": "Raxa BNB Mensalidade",
   "purchase_date": "15-01-2024",
   "installments": '',
   "group": 'Despesas',
   "real_amount": 60
  }
]

acount_transactions_mensalidade_luana = [
  {
    "kind": "revenue",
    "title": "Plano de saude",
    "purchase_date": "10-01-2024",
    "installments": '',
    "group": 'Mensalidade Luana',
    "payers": "Luana",
    "real_amount": 200
  },
  {
    "kind": "revenue",
    "title": "Alimentacao",
    "purchase_date": "10-01-2024",
    "installments": '',
    "group": 'Mensalidade Luana',
    "payers": "Luana",
    "real_amount": 150
  },
  {
    "kind": "revenue",
    "title": "Necesser",
    "purchase_date": "10-01-2024",
    "installments": '',
    "group": 'Mensalidade Luana',
    "payers": "Luana",
    "real_amount": 25
  },
  {
    "kind": "revenue",
    "title": "A parte",
    "purchase_date": "10-01-2024",
    "installments": '',
    "group": 'Mensalidade Luana',
    "payers": "Luana",
    "real_amount": 192
  },
]

finance_transactions_investimentos = [
  {
    "title": "Fundos imobiliarios",
    "purchase_date": "02-01-2024",
    "installments": '',
    "group": 'Investimentos',
    "real_amount": 500
  },
  {
    "title": "Acoes",
    "purchase_date": "02-01-2024",
    "installments": '',
    "group": 'Investimentos',
    "real_amount": 500
  }
]

finance_transactions_receitas = [
  {
    "kind": "revenue",
    "title": "Salario",
    "purchase_date": "30-01-2024",
    "installments": '',
    "group": 'Receitas',
    "payers": "IA",
    "real_amount": 4313.17
  },
  {
    "kind": "revenue",
    "title": "Ressalva ppay",
    "purchase_date": "30-01-2024",
    "installments": '',
    "group": 'Receitas',
    "real_amount": 1500
  }
]

# finance transactions January of 2024
                                    
def create_payers(payers)
  payers.each do |payer|
    payer_created = Payer.create!(
      name: payer[:name]
    )

    puts "Create payer: #{payer_created.attributes}"
  end
end

def create_groups(groups)
  groups.each do |group|
    # payer = Payer.find_by(name: group[:payer])

    group_created = Group.create!(
      title: group[:title],
      payment_day: group[:payment_day],
      close_day: group[:close_day],
      kind: group[:kind],
      # payer: payer
    )

    puts "Create group: #{group_created.attributes}"
  end
end

def create_finance_transactions_and_payers(finance_transactions)
  finance_transactions.each do |finance_transaction|
    if finance_transaction[:group].is_a?(Array)
      finance_transaction[:group].each_with_index do |group_name, index|
        group = Group.find_by(title: group_name)
        payers_name = finance_transaction[:payers].split(',')
        payer = Payer.find_by(name: payers_name[index])

        attributes = {
          title: finance_transaction[:title],
          purchase_date: finance_transaction[:purchase_date],
          installments: finance_transaction[:installments],
          real_amount: payer.name == 'Ryan' ? finance_transaction[:real_amount] : finance_transaction[:real_amount] / payers_name.size
        }

        if finance_transaction[:kind].present?
          attributes.merge!(kind: finance_transaction[:kind])
        elsif payer.present? && payer.name != 'Ryan'
          attributes.merge!(kind: :revenue)
        end

        finance_transaction_created = FinanceTransaction.create!(attributes)

        puts "Create finance transaction: #{finance_transaction_created.attributes}"

        payer_finance_transaction_created = PayersFinanceTransaction.create!(
          finance_transaction: finance_transaction_created,
          payer: payer,
        )

        puts "Create payer finance transaction: #{payer_finance_transaction_created.attributes}"

        group_finance_transaction_created = GroupsFinanceTransaction.create!(
          finance_transaction: finance_transaction_created,
          group: group
        )

        puts "Create group finance transaction: #{group_finance_transaction_created.attributes}"
      end
    else
      group = Group.find_by(title: finance_transaction[:group])
      payer = finance_transaction[:payers].present? ? Payer.find_by(name: finance_transaction[:payers]) : Payer.find_by(name: 'Ryan')

      attributes = {
        title: finance_transaction[:title],
        purchase_date: finance_transaction[:purchase_date],
        installments: finance_transaction[:installments],
        real_amount: finance_transaction[:real_amount]
      }

      if finance_transaction[:kind].present?
        attributes.merge!(kind: finance_transaction[:kind])
      elsif payer.present? && payer.name != 'Ryan'
        attributes.merge!(kind: :revenue)
      end

      finance_transaction_created = FinanceTransaction.create!(attributes)

      puts "Create finance transaction: #{finance_transaction_created.attributes}"

      payer_finance_transaction_created = PayersFinanceTransaction.create!(
        finance_transaction: finance_transaction_created,
        payer: payer,
      )

      puts "Create payer finance transaction: #{payer_finance_transaction_created.attributes}"

      group_finance_transaction_created = GroupsFinanceTransaction.create!(
          finance_transaction: finance_transaction_created,
          group: group
        )

        puts "Create group finance transaction: #{group_finance_transaction_created.attributes}"
    end
  end
end

puts "Creating initial payers..."

create_payers(initial_payers)

puts "Payers created"

puts "Creating initial groups..."

create_groups(initial_groups)

puts "Groups created"

puts "Creating finance transactions..."

create_finance_transactions_and_payers(finance_transactions_nubank_mamae)
create_finance_transactions_and_payers(finance_transactions_nubank_ryan)
create_finance_transactions_and_payers(finance_transactions_pic_pay)
create_finance_transactions_and_payers(finance_transactions_despesas)
create_finance_transactions_and_payers(acount_transactions_mensalidade_luana)
create_finance_transactions_and_payers(finance_transactions_investimentos)
create_finance_transactions_and_payers(finance_transactions_receitas)

puts "Finance transactions created"
